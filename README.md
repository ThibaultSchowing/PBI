# PBI

Phages Bacteria Interaction exploration and overview

## Stage 1 - PhageScope

Chosen for its large number of source database, [PhageScope](https://phagescope.deepomics.org/) contains phage and protein sequences alongside multiple metadata such as virulence factor, protein annotation, anti-crispr, transmembrane protein, tRNA - mRNA or transcription terminator. Phages metadata contain the **Host species** of the phage, necessary information for further work on prediction of these interactions. Moreover, sequences are clustered 

All the data from PhageScope come from a set of 13 databases: 

- RefSeq
- Genbank
- EMBL
- DDBJ
- PhagesDB
- GVD
- GPD
- MGV
- TemPhD
- CHVD
- IGVD
- IMGVR
- GOV2
- STV

![Image from phagescope.deepomics.org](https://phagescope.deepomics.org/png/databasevis.png)
![Image from phagescope.deepomics.org](https://phagescope.deepomics.org/png/analysisvis.png)
![Image from phagescope.deepomics.org](https://phagescope.deepomics.org/png/visualization.png)


TODO: Check clustering info https://github.com/soedinglab/mmseqs2/wiki#clustering

### Download  Snakemake pipeline with Pixi

For details check Snakemake 9.8.0 documentation and Pixi documentation. 

For details on multi-environments with Pixi check [here](https://pixi.sh/latest/tutorials/multi_environment/#lets-get-started). 

Snakemake is run from pixi, with pixi run



TODO: show .toml file here

### To Be Moved : 

- Don't forget to run  `pixi install --environment <envname>`
- Add Pixi and Snakemake files to .gitignore

# TODO: 

- Adapt current files for new workflow structure (everything moved within the workflow dir)


### How to 

Snakemake is launched from Pixi with `pixi run`. 

Input, output, log, and benchmark files are considered to be relative to the working directory (**either the directory in which you have invoked Snakemake** or whatever was specified for --directory or the workdir: directive). -> from the workflow directory !


The Pixi environment needs to be exported first with `pixi workspace export conda-environment -e base envs/pixi_base_enf.yaml`

The Conda environment to use is specified within each rule (if needed) with 

```
    conda:
        "envs/pixi_base_env.yaml"
```

Cache: to use caching, it is first needed to export snakemake cache with `export SNAKEMAKE_OUTPUT_CACHE=/mnt/snakemake-cache/` (create the destination directory first). 

- pixi run snakemake all --cache --use-conda --printshellcmds --cores 2
    - optionally to generate the DAG you can add: --dag | dot -Tsvg > dag.svg

- **Current command:** `pixi run snakemake --directory workflow --snakefile workflow/Snakefile --cache --use-conda --printshellcmds --cores 4 `
    - **DAG Option (path relative to bash location)**`--dag | dot -Tsvg > workflow/dag/dag_rerun.svg`

To remove the temporary files after execution, use --delete-temp-output. Has to be done separately  (to be verified):
- pixi run snakemake --delete-temp-output

- TODO: command to remove temporary objects

```
--delete-temp-output


Remove all temporary files generated by the workflow. Use together with â€“dry-run to list files without actually deleting anything. Note that this will not recurse into subworkflows.
```






# Temporary files

```
Deleting data/intermediate_csv/phage_metadata/RefSeq_Phage_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_metadata/Genbank_Phage_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_metadata/EMBL_Phage_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_metadata/DDBJ_Phage_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_metadata/PhagesDB_Phage_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_metadata/GVD_Phage_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_metadata/GPD_Phage_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_metadata/MGV_Phage_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_metadata/TemPhD_Phage_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_metadata/CHVD_Phage_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_metadata/IGVD_Phage_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_metadata/IMGVR_Phage_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_metadata/GOV2_Phage_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_metadata/STV_Phage_Metadata_URL.tsv
Deleting data/intermediate_csv/annotated_proteins_metadata/RefSeq_Annotated_Proteins_metadata_URL.tsv
Deleting data/intermediate_csv/annotated_proteins_metadata/Genbank_Annotated_Proteins_metadata_URL.tsv
Deleting data/intermediate_csv/annotated_proteins_metadata/EMBL_Annotated_Proteins_metadata_URL.tsv
Deleting data/intermediate_csv/annotated_proteins_metadata/DDBJ_Annotated_Proteins_metadata_URL.tsv
Deleting data/intermediate_csv/annotated_proteins_metadata/PhagesDB_Annotated_Proteins_metadata_URL.tsv
Deleting data/intermediate_csv/annotated_proteins_metadata/GVD_Annotated_Proteins_metadata_URL.tsv
Deleting data/intermediate_csv/annotated_proteins_metadata/GPD_Annotated_Proteins_metadata_URL.tsv
Deleting data/intermediate_csv/annotated_proteins_metadata/MGV_Annotated_Proteins_metadata_URL.tsv
Deleting data/intermediate_csv/annotated_proteins_metadata/TemPhD_Annotated_Proteins_metadata_URL.tsv
Deleting data/intermediate_csv/annotated_proteins_metadata/CHVD_Annotated_Proteins_metadata_URL.tsv
Deleting data/intermediate_csv/annotated_proteins_metadata/IGVD_Annotated_Proteins_metadata_URL.tsv
Deleting data/intermediate_csv/annotated_proteins_metadata/IMGVR_Annotated_Proteins_metadata_URL.tsv
Deleting data/intermediate_csv/annotated_proteins_metadata/GOV2_Annotated_Proteins_metadata_URL.tsv
Deleting data/intermediate_csv/annotated_proteins_metadata/STV_Annotated_Proteins_metadata_URL.tsv
Deleting data/intermediate_csv/transcription_terminator_metadata/RefSeq_Phage_Transcription_Terminator_Metadata_URL.tsv
Deleting data/intermediate_csv/transcription_terminator_metadata/Genbank_Phage_Transcription_Terminator_Metadata_URL.tsv
Deleting data/intermediate_csv/transcription_terminator_metadata/EMBL_Phage_Transcription_Terminator_Metadata_URL.tsv
Deleting data/intermediate_csv/transcription_terminator_metadata/DDBJ_Phage_Transcription_Terminator_Metadata_URL.tsv
Deleting data/intermediate_csv/transcription_terminator_metadata/PhagesDB_Phage_Transcription_Terminator_Metadata_URL.tsv
Deleting data/intermediate_csv/transcription_terminator_metadata/GVD_Phage_Transcription_Terminator_Metadata_URL.tsv
Deleting data/intermediate_csv/transcription_terminator_metadata/GPD_Phage_Transcription_Terminator_Metadata_URL.tsv
Deleting data/intermediate_csv/transcription_terminator_metadata/MGV_Phage_Transcription_Terminator_Metadata_URL.tsv
Deleting data/intermediate_csv/transcription_terminator_metadata/TemPhD_Phage_Transcription_Terminator_Metadata_URL.tsv
Deleting data/intermediate_csv/transcription_terminator_metadata/CHVD_Phage_Transcription_Terminator_Metadata_URL.tsv
Deleting data/intermediate_csv/transcription_terminator_metadata/IGVD_Phage_Transcription_Terminator_Metadata_URL.tsv
Deleting data/intermediate_csv/transcription_terminator_metadata/GOV2_Phage_Transcription_Terminator_Metadata_URL.tsv
Deleting data/intermediate_csv/transcription_terminator_metadata/STV_Phage_Transcription_Terminator_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_trna_tmrna_metadata/RefSeq_Phage_tRNA_tmRNA_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_trna_tmrna_metadata/Genbank_Phage_tRNA_tmRNA_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_trna_tmrna_metadata/EMBL_Phage_tRNA_tmRNA_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_trna_tmrna_metadata/DDBJ_Phage_tRNA_tmRNA_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_trna_tmrna_metadata/PhagesDB_Phage_tRNA_tmRNA_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_trna_tmrna_metadata/GVD_Phage_tRNA_tmRNA_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_trna_tmrna_metadata/GPD_Phage_tRNA_tmRNA_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_trna_tmrna_metadata/MGV_Phage_tRNA_tmRNA_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_trna_tmrna_metadata/TemPhD_Phage_tRNA_tmRNA_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_trna_tmrna_metadata/CHVD_Phage_tRNA_tmRNA_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_trna_tmrna_metadata/IGVD_Phage_tRNA_tmRNA_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_trna_tmrna_metadata/IMGVR_Phage_tRNA_tmRNA_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_trna_tmrna_metadata/GOV2_Phage_tRNA_tmRNA_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_trna_tmrna_metadata/STV_Phage_tRNA_tmRNA_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_anti_crispr_metadata/RefSeq_Phage_AntiCRISPR_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_anti_crispr_metadata/Genbank_Phage_AntiCRISPR_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_anti_crispr_metadata/EMBL_Phage_AntiCRISPR_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_anti_crispr_metadata/DDBJ_Phage_AntiCRISPR_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_anti_crispr_metadata/PhagesDB_Phage_AntiCRISPR_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_anti_crispr_metadata/GVD_Phage_AntiCRISPR_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_anti_crispr_metadata/GPD_Phage_AntiCRISPR_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_anti_crispr_metadata/MGV_Phage_AntiCRISPR_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_anti_crispr_metadata/CHVD_Phage_AntiCRISPR_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_anti_crispr_metadata/IGVD_Phage_AntiCRISPR_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_anti_crispr_metadata/IMGVR_Phage_AntiCRISPR_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_anti_crispr_metadata/GOV2_Phage_AntiCRISPR_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_anti_crispr_metadata/STV_Phage_AntiCRISPR_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_virulent_factor_metadata/RefSeq_Phage_Virulent_Factor_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_virulent_factor_metadata/Genbank_Phage_Virulent_Factor_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_virulent_factor_metadata/EMBL_Phage_Virulent_Factor_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_virulent_factor_metadata/DDBJ_Phage_Virulent_Factor_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_virulent_factor_metadata/GVD_Phage_Virulent_Factor_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_virulent_factor_metadata/GPD_Phage_Virulent_Factor_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_virulent_factor_metadata/MGV_Phage_Virulent_Factor_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_virulent_factor_metadata/TemPhD_Phage_Virulent_Factor_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_virulent_factor_metadata/CHVD_Phage_Virulent_Factor_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_virulent_factor_metadata/IGVD_Phage_Virulent_Factor_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_virulent_factor_metadata/GOV2_Phage_Virulent_Factor_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_transmembrane_protein_metadata/RefSeq_Phage_Transmembrane_Protein_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_transmembrane_protein_metadata/Genbank_Phage_Transmembrane_Protein_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_transmembrane_protein_metadata/EMBL_Phage_Transmembrane_Protein_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_transmembrane_protein_metadata/DDBJ_Phage_Transmembrane_Protein_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_transmembrane_protein_metadata/PhagesDB_Phage_Transmembrane_Protein_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_transmembrane_protein_metadata/GVD_Phage_Transmembrane_Protein_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_transmembrane_protein_metadata/GPD_Phage_Transmembrane_Protein_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_transmembrane_protein_metadata/MGV_Phage_Transmembrane_Protein_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_transmembrane_protein_metadata/TemPhD_Phage_Transmembrane_Protein_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_transmembrane_protein_metadata/CHVD_Phage_Transmembrane_Protein_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_transmembrane_protein_metadata/IGVD_Phage_Transmembrane_Protein_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_transmembrane_protein_metadata/GOV2_Phage_Transmembrane_Protein_Metadata_URL.tsv
Deleting data/intermediate_csv/phage_transmembrane_protein_metadata/STV_Phage_Transmembrane_Protein_Metadata_URL.tsv
Deleting data/protein_fasta/Genbank/.extraction_done
Deleting data/protein_fasta_compressed/Genbank.tar.gz
Deleting data/protein_fasta/RefSeq/.extraction_done
Deleting data/protein_fasta_compressed/RefSeq.tar.gz
Deleting data/protein_fasta/DDBJ/.extraction_done
Deleting data/protein_fasta_compressed/DDBJ.tar.gz
Deleting data/protein_fasta/EMBL/.extraction_done
Deleting data/protein_fasta_compressed/EMBL.tar.gz
Deleting data/protein_fasta/PhagesDB/.extraction_done
Deleting data/protein_fasta_compressed/PhagesDB.tar.gz
Deleting data/protein_fasta/GPD/.extraction_done
Deleting data/protein_fasta_compressed/GPD.tar.gz
Deleting data/protein_fasta/GVD/.extraction_done
Deleting data/protein_fasta_compressed/GVD.tar.gz
Deleting data/protein_fasta/MGV/.extraction_done
Deleting data/protein_fasta_compressed/MGV.tar.gz
Deleting data/protein_fasta/TemPhD/.extraction_done
Deleting data/protein_fasta_compressed/TemPhD.tar.gz
Deleting data/protein_fasta/CHVD/.extraction_done
Deleting data/protein_fasta_compressed/CHVD.tar.gz
Deleting data/protein_fasta/IGVD/.extraction_done
Deleting data/protein_fasta_compressed/IGVD.tar.gz
Deleting data/protein_fasta/GOV2/.extraction_done
Deleting data/protein_fasta_compressed/GOV2.tar.gz
Deleting data/protein_fasta/STV/.extraction_done
Deleting data/protein_fasta_compressed/STV.tar.gz
Deleting data/phage_fasta/Genbank/.extraction_done
Deleting data/phage_fasta_compressed/Genbank.tar.gz
Deleting data/phage_fasta/RefSeq/.extraction_done
Deleting data/phage_fasta_compressed/RefSeq.tar.gz
Deleting data/phage_fasta/DDBJ/.extraction_done
Deleting data/phage_fasta_compressed/DDBJ.tar.gz
Deleting data/phage_fasta/EMBL/.extraction_done
Deleting data/phage_fasta_compressed/EMBL.tar.gz
Deleting data/phage_fasta/PhagesDB/.extraction_done
Deleting data/phage_fasta_compressed/PhagesDB.tar.gz
Deleting data/phage_fasta/GPD/.extraction_done
Deleting data/phage_fasta_compressed/GPD.tar.gz
Deleting data/phage_fasta/GVD/.extraction_done
Deleting data/phage_fasta_compressed/GVD.tar.gz
Deleting data/phage_fasta/MGV/.extraction_done
Deleting data/phage_fasta_compressed/MGV.tar.gz
Deleting data/phage_fasta/TemPhD/.extraction_done
Deleting data/phage_fasta_compressed/TemPhD.tar.gz
Deleting data/phage_fasta/CHVD/.extraction_done
Deleting data/phage_fasta_compressed/CHVD.tar.gz
Deleting data/phage_fasta/IGVD/.extraction_done
Deleting data/phage_fasta_compressed/IGVD.tar.gz
Deleting data/phage_fasta/IMGVR/.extraction_done
Deleting data/phage_fasta_compressed/IMGVR.tar.gz
Deleting data/phage_fasta/GOV2/.extraction_done
Deleting data/phage_fasta_compressed/GOV2.tar.gz
Deleting data/phage_fasta/STV/.extraction_done
Deleting data/phage_fasta_compressed/STV.tar.gz
```
